async function check(e){return new Promise((a,o)=>{setTimeout(()=>{fs.readFile(e,"utf8",function(e,o){if(!e)return console.log("Get the file..."),a(!0);check()})},5e3)})}const{createCanvas:createCanvas,loadImage:loadImage,cairoVersion:cairoVersion}=require("canvas"),webp=require("webp-converter"),sizeOf=require("image-size"),path=require("path"),fs=require("fs"),{json:json}=require("body-parser");exports.decodingMangaScript=(()=>{const e=createCanvas(1e3,2405),a=e.getContext("2d");loadImage("./images/image_test.jpg").then(o=>{for(var t=[["500.00","962.00","0.00","0.00"],["500.00","481.00","0.00","481.00"],["0.00","1443.00","0.00","962.00"],["0.00","0.00","0.00","1443.00"],["0.00","481.00","0.00","1924.00"],["500.00","1924.00","500.00","0.00"],["500.00","0.00","500.00","481.00"],["0.00","1924.00","500.00","962.00"],["0.00","962.00","500.00","1443.00"],["500.00","1443.00","500.00","1924.00"]],r=0;r<t.length;r++)a.drawImage(o,t[r][2],t[r][3],500,294,t[r][0],t[r][1],500,294);var n=e.toDataURL().replace(/^data:image\/png;base64,/,"");require("fs").writeFile("./public/bot/out/out.png",n,"base64",function(e){console.log(e)}).then(e=>{print(finished)})})}),exports.decodingCanvas=(async(e,a,o,t)=>{webp.grant_permission();var r=path.extname(t);console.log(`FILE NAME ==============================> ${r}`);var n=100;const i=await sizeOf(a);n=i.height,console.log(`Canvas Height: ${n}`);var s=createCanvas(1e3,n);const l=s.getContext("2d");var c="./public/bot/out/";fs.existsSync(c)||fs.mkdirSync(dir,{recursive:!0}),console.log("=========================fff======================"),console.log(t),console.log(a),console.log("file type: "),".jpg"!=r&&await webp.dwebp(a,"./public/bot/"+t,"-o",logging="-v"),console.log("========================= result load img ======================");await loadImage("./public/bot/"+t).then().catch(e=>webp.dwebp(a,"./public/bot/"+t,"-o",logging="-v"));return console.log("=========================jjj======================"),console.log("Loading Image..."+t),loadImage("./public/bot/"+t).then(async a=>{console.log("creating new image");for(var r=0;r<e.length;r++)l.drawImage(a,e[r][o.parameter[1]],e[r][o.parameter[2]],o.parameter[3],o.parameter[4],e[r][o.parameter[5]],e[r][o.parameter[6]],o.parameter[7],o.parameter[8]);l.font="19px Times New Roman",l.fillStyle="# FFC82C",l.textAlign="right",l.fillText("[dMath]",i.width-20,i.height-20);var n=s.toDataURL().replace(/^data:image\/png;base64,/,"");console.log("write file..."),fs.writeFile(`${c+t}`,n,"base64",function(e){console.log(e)});const g=c+t;var p=await check(g);console.log(`checker ${c+t}`),p&&console.log("finished!!!...")})});